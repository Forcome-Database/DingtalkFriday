# 员工请假数据导出系统 — 开发需求文档

## 一、系统概述

开发一个员工请假数据查询与导出功能模块，支持按部门、年份、请假类型筛选员工请假数据，以月度表格形式展示，支持下钻到日历明细，并提供 Excel 导出能力。

---

## 二、功能模块

### 2.1 顶部导航栏

| 需求项 | 说明 |
|--------|------|
| 系统名称 | 左侧显示图标 + "员工请假管理系统" |
| 用户信息 | 右侧显示当前登录用户头像 + 姓名（如"管理员"） |

### 2.2 筛选模块

#### 2.2.1 部门筛选（多级联动）

- 提供至少 2 级部门联动下拉框（一级部门 → 二级部门）
- 默认展示一级部门，选择后联动加载二级部门
- 接口需求：`GET /api/departments?parentId={id}` 返回子部门列表
- 支持"全部部门"选项

#### 2.2.2 员工姓名搜索

- 输入框支持模糊搜索，按姓名关键字过滤
- 建议实现前端防抖（300ms），输入后实时过滤当前列表
- 也可配合后端接口：`GET /api/employees?keyword={name}&deptId={id}`

#### 2.2.3 年份选择

- 下拉选择器，默认当前年份
- 选项范围：近 5 年（如 2021-2025）
- 选择年份后表格展示该年 1-12 月数据

#### 2.2.4 请假类型多选

- 标签式多选控件，支持的类型：`年假`、`事假`、`病假`、`调休`（可扩展）
- 提供"全部"快捷按钮，点击后全选/反选
- 选中状态：彩色背景 + check 图标；未选中状态：灰色边框
- 每种类型对应颜色编码：
  - 年假：蓝色 `#DBEAFE` / `#2563EB`
  - 事假：黄色 `#FEF3C7` / `#B45309`
  - 病假：红色 `#FEE2E2` / `#DC2626`
  - 调休：绿色 `#D1FAE5` / `#059669`

#### 2.2.5 操作按钮

- 「查询」按钮：根据筛选条件重新加载数据
- 「重置」按钮：清空所有筛选条件恢复默认值

---

### 2.3 数据统计卡片

查询结果返回后，在表格上方展示 4 张统计卡片：

| 卡片 | 数据来源 | 说明 |
|------|---------|------|
| 请假总人次 | `count(请假记录)` | 符合条件的请假记录条数 |
| 请假总天数 | `sum(请假时长)` | 按天或小时换算，保留1位小数 |
| 人均请假 | `总天数 / 去重员工数` | 保留1位小数，单位"天/人" |
| 年假占比 | `年假天数 / 总天数 * 100%` | 百分比 + 具体天数 |

---

### 2.4 数据列表（月度表格）

#### 2.4.1 表格结构

| 列 | 宽度 | 说明 |
|----|------|------|
| 员工姓名 | 固定 90px | 员工姓名，左对齐 |
| 部门 | 固定 90px | 所属部门名称 |
| 1月 ~ 12月 | 自适应均分 | 对应月份的请假天数/小时数 |
| 合计 | 固定 60px | 该行全年汇总，蓝底高亮 |

#### 2.4.2 单元格数据规则

- 有请假数据：显示数值（保留1位小数，如 `2.5`），字体加粗，颜色与请假类型对应
- 无请假数据：显示 `-`，灰色
- 若同一员工同月有多种类型请假，数值为所选类型的合计

#### 2.4.3 统计单位切换

- 表格信息栏提供「按天 / 按小时」分段控件
- 按天模式：数值为天数（8小时 = 1天），保留1位小数
- 按小时模式：数值为实际小时数
- 切换后表格数据和统计卡片同步刷新

#### 2.4.4 汇总行

- 表格底部固定显示合计行（蓝底背景）
- 第一列显示"合计"，第二列显示人数
- 各月份列显示该月所有员工请假天数/小时数之和
- 合计列显示全年总计

#### 2.4.5 排序

- 「合计」列表头支持点击排序（升序/降序）
- 默认按员工姓名排序

#### 2.4.6 分页

- 底部显示分页信息："显示 x-y / 共 z 条"
- 分页控件：上一页、页码、下一页
- 默认每页 10 条（可配置）

---

### 2.5 日历明细面板（弹窗/抽屉）

**触发方式：** 点击月度表格中任意有数据的单元格

#### 2.5.1 面板头部

- 员工头像（姓氏首字母）+ 姓名 · 部门
- 副标题：`{年份}年{月份}月 请假明细`
- 右上角关闭按钮

#### 2.5.2 月度日历网格

- 标准日历布局（周一至周日，6行7列）
- 日期状态标记：
  - **全天请假：** 蓝色实底背景 `#DBEAFE`
  - **不足全天（含小时级请假）：** 蓝色底 + 虚线边框
  - **无请假：** 无背景
  - **周末：** 浅灰色文字
- 底部图例说明三种状态

#### 2.5.3 请假记录列表

- 按日期排列，每条记录展示：
  - 日期 + 星期（如"3月14日（周五）"）
  - 时间段（如"14:00 - 18:00"）
  - 时长标注（"半天 · 4小时" 或 "全天 · 8小时"）
  - 请假类型标签（带颜色）
  - 审批状态（已审批/审批中/已驳回）

#### 2.5.4 底部汇总

- 显示本月合计：天数 + 小时数 双维度
- 如 "2.5 天 · 20 小时"

---

### 2.6 导出功能

| 需求项 | 说明 |
|--------|------|
| 触发 | 页面右上角「导出 Excel」按钮 |
| 导出范围 | 当前筛选条件下的全部数据（非仅当前页） |
| 文件格式 | `.xlsx`（Excel 2007+） |
| 文件命名 | `请假数据_{部门}_{年份}.xlsx` |
| 表头 | 与页面表格一致：员工姓名、部门、1-12月、合计 |
| 数据精度 | 根据当前单位切换状态导出（天或小时） |
| 附加 | 导出时包含汇总行 |

---

## 三、接口设计

```
# 1. 部门树
GET /api/departments?parentId={id}
Response: [{ id, name, parentId, hasChildren }]

# 2. 请假月度汇总数据
GET /api/leave/monthly-summary
Params:
  - year: number          # 年份
  - deptId: number        # 部门ID（可选）
  - leaveTypes: string[]  # 请假类型数组
  - employeeName: string  # 员工姓名关键字（可选）
  - unit: day|hour        # 统计单位
  - page: number          # 页码
  - pageSize: number      # 每页条数
  - sortBy: string        # 排序字段（默认 name）
  - sortOrder: asc|desc   # 排序方向
Response: {
  stats: {
    totalCount: number,    // 请假总人次
    totalDays: number,     // 请假总天数
    avgDays: number,       // 人均天数
    annualRatio: number    // 年假占比（百分比）
  },
  list: [{
    employeeId: number,
    name: string,
    dept: string,
    months: [m1, m2, ..., m12],  // 各月数值
    total: number                 // 全年合计
  }],
  summary: {
    personCount: number,
    months: [m1, m2, ..., m12],  // 各月汇总
    total: number                 // 总计
  },
  pagination: {
    page: number,
    pageSize: number,
    total: number
  }
}

# 3. 日历明细
GET /api/leave/daily-detail
Params:
  - employeeId: number  # 员工ID
  - year: number        # 年份
  - month: number       # 月份
Response: {
  employee: {
    name: string,
    dept: string
  },
  records: [{
    date: string,        // 日期 YYYY-MM-DD
    startTime: string,   // 开始时间 HH:mm
    endTime: string,     // 结束时间 HH:mm
    hours: number,       // 时长（小时）
    leaveType: string,   // 年假|事假|病假|调休
    status: string       // 已审批|审批中|已驳回
  }],
  summary: {
    totalDays: number,   // 合计天数
    totalHours: number   // 合计小时数
  }
}

# 4. 导出
POST /api/leave/export
Body: {
  year: number,
  deptId: number,
  leaveTypes: string[],
  employeeName: string,
  unit: day|hour
}
Response: 文件流（application/vnd.openxmlformats-officedocument.spreadsheetml.sheet）
```

---

## 四、数据模型

```sql
-- 请假记录表
CREATE TABLE leave_record (
    id              BIGINT PRIMARY KEY AUTO_INCREMENT,
    employee_id     BIGINT NOT NULL COMMENT '员工ID',
    leave_type      VARCHAR(20) NOT NULL COMMENT '请假类型：年假|事假|病假|调休',
    start_time      DATETIME NOT NULL COMMENT '开始时间（精确到分钟）',
    end_time        DATETIME NOT NULL COMMENT '结束时间（精确到分钟）',
    duration_hours  DECIMAL(5,1) NOT NULL COMMENT '时长（小时）',
    status          VARCHAR(20) DEFAULT '已审批' COMMENT '审批状态：已审批|审批中|已驳回',
    reason          TEXT COMMENT '请假事由',
    approver_id     BIGINT COMMENT '审批人ID',
    created_at      DATETIME DEFAULT NOW(),
    updated_at      DATETIME DEFAULT NOW() ON UPDATE NOW(),
    INDEX idx_employee_id (employee_id),
    INDEX idx_leave_type (leave_type),
    INDEX idx_start_time (start_time),
    INDEX idx_status (status)
) COMMENT '请假记录表';

-- 员工表
CREATE TABLE employee (
    id          BIGINT PRIMARY KEY AUTO_INCREMENT,
    name        VARCHAR(50) NOT NULL COMMENT '姓名',
    dept_id     BIGINT NOT NULL COMMENT '部门ID',
    position    VARCHAR(100) COMMENT '职位',
    status      TINYINT DEFAULT 1 COMMENT '状态：1在职 0离职',
    created_at  DATETIME DEFAULT NOW(),
    INDEX idx_dept_id (dept_id),
    INDEX idx_name (name)
) COMMENT '员工表';

-- 部门表
CREATE TABLE department (
    id          BIGINT PRIMARY KEY AUTO_INCREMENT,
    name        VARCHAR(100) NOT NULL COMMENT '部门名称',
    parent_id   BIGINT COMMENT '上级部门ID，NULL为一级部门',
    sort_order  INT DEFAULT 0 COMMENT '排序',
    INDEX idx_parent_id (parent_id)
) COMMENT '部门表';
```

---

## 五、UI 色彩规范

### 请假类型颜色

| 类型 | 背景色 | 文字色 |
|------|--------|--------|
| 年假 | `#DBEAFE` | `#2563EB` |
| 事假 | `#FEF3C7` | `#B45309` |
| 病假 | `#FEE2E2` | `#DC2626` |
| 调休 | `#D1FAE5` | `#059669` |

### 通用色彩

| 用途 | 色值 |
|------|------|
| 页面背景 | `#FFFFFF` |
| 表面背景 | `#F9FAFB` |
| 主色调 | `#2563EB` |
| 主文字 | `#18181B` |
| 次要文字 | `#71717A` |
| 占位文字 | `#A1A1AA` |
| 边框 | `#E4E4E7` |
| 高亮背景 | `#EFF6FF` |
| 成功 | `#16A34A` |
| 警告 | `#F59E0B` |
| 错误 | `#DC2626` |

### 字体

- 字体族：`Inter`（无衬线）
- 标题：18-24px / weight 600
- 正文：13-14px / weight 400-500
- 辅助：11-12px / weight 500

---

## 六、非功能需求

| 项目 | 要求 |
|------|------|
| 性能 | 查询响应 < 1s（1000条以内），导出 < 5s（10000条以内） |
| 兼容 | Chrome 90+、Edge 90+、Firefox 88+ |
| 权限 | 仅部门管理员及以上角色可访问，数据范围受部门权限控制 |
| 日志 | 记录导出操作日志（操作人、时间、筛选条件） |
| 响应式 | 最小支持宽度 1280px，表格支持横向滚动 |

---

## 七、UI 参考

设计稿位于项目根目录 `.pen` 文件中，包含：
- **主界面**：完整的筛选 + 统计卡片 + 月度表格布局
- **日历明细面板**：点击单元格后的弹出式日历 + 请假记录详情
